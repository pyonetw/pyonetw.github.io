<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="utf-8">
    <title>第五週練習：報童問題之最佳訂貨量（進階版）</title>
    <link rel="icon" href="/favicon.png">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="/static/vice.css?250715">
</head>
<body>
    <div class="container">
        <h1 class="my-3">第五週練習：報童問題之最佳訂貨量（進階版）</h1>
        <p>本題是第四週作業「報童問題：該買幾份報紙？」的進階版，演算規則與該題大同小異（新增了報紙沒賣完可以當廢紙賣掉的殘值），輸入資訊亦有不同（題目會給定殘值資訊，且機率值個數 \(N\) 不再僅限於 \(8\)），而輸出格式則一樣。為了方便起見，以下我們列出完整的題目敘述。</p>

        <h2>題目來源</h2>
        <p class="text-danger">台大資管系孔令傑教授</p>

        <h2>題目敘述</h2>
        <p>你經營一家報攤專賣一份日報，今天下午你得在報社關門前下訂單，告訴報社你要為明天訂購幾份報紙，隔天清晨你就會收到訂購的報紙並且付款。每份報紙的進貨價格是 \(c\) 元，賣給客人的零售價則是 \(r\) 元，而每一份沒賣出去的報紙，在明天結束時可以被以一份 \(s\) 元的殘值（salvage value）當作廢紙賣掉。每天會來多少個客人想買報紙是件不確定的事，也就是說單日需求量 \(D\) 是隨機的。根據過往經驗，你估計明天的單日需求量會落在 \(0\) 和 \(N\) 之間，並且符合如下的機率分佈：</p>

        <p>\(Pr(D=i)=pi, i=0,1,...,N\)</p>

        <p>意思是說，有 \(0\) 個人來買報紙的機率是 \(p_0\)、有 \(1\) 個人來買報紙的機率是 \(p_1\)，依此類推，最後是賣出 \(N\) 份報紙的機率是 \(p_N\)  。你想要決定你的訂貨量 \(q^*\) 去最大化你的期望利潤（expected profit）</p>

        <p>\(π(q)=r\mathbb{E}[min\{q,D\}]−cq+s\mathbb{E}[max\{q−D,0\}]\)</p>

        <p>其中 \(min\{q,D\}\) 是明天的銷售量（訂貨量和需求量中比較小的那個數字）、\(\mathbb{E}[min\{q,D\}]\) 是預期銷售量（也就是銷售量取期望值）、\(r\mathbb{E}[min\{q,D\}]\) 是預期銷售收益、\(cq\) 是必須付給報社的進貨成本、\(max\{q-D,0\}\)是沒賣掉的份數，\(D \geq q\) 表示沒有剩），因此 \(s\mathbb{E}[\max\{q - D, 0\}]\) 是預期總殘值。這是一個作業管理（operations management）領域的經典存貨問題（inventory problem），因為是很多存貨管理方法的基礎，被特別給予一個名稱叫「報童問題」（newsvendor problem）。</p>

        <p>以下我們用一個例子來說明報童問題。假設進貨成本 \(c=2\)、零售價格 \(r=10\)、殘值 \(s=1\)，而且明天的單日需求量 \(D\) 符合如下的機率分佈：</p>

        <table style="width: 300px;">
            <thead>
                <tr>
                    <th>\(i\)</th>
                    <th>\(Pr(D=x_{i})\)</th>
                </tr>
            </thead>
            <tbody>
                <tr> <td>0</td> <td>0.06</td> </tr>
                <tr> <td>1</td> <td>0.15</td> </tr>
                <tr> <td>2</td> <td>0.22</td> </tr>
                <tr> <td>3</td> <td>0.22</td> </tr>
                <tr> <td>4</td> <td>0.17</td> </tr>
                <tr> <td>5</td> <td>0.10</td> </tr>
                <tr> <td>6</td> <td>0.05</td> </tr>
                <tr> <td>7</td> <td>0.02</td> </tr>
                <tr> <td>8</td> <td>0.01</td> </tr>
            </tbody>
        </table>

        <p>也就是說有 \(6\%\) 的機率沒有任何人想買報紙、\(15\%\) 的機率有一個人想要買，依此類推。你有九個可能的訂貨量（其實有無限多個，不過你應該不會想訂超過八份報紙吧？），讓我們來分析其中幾個：</p>

        <ol>
            <li>如果你不訂貨（\(q=0\)），顯然一份報紙也不會賣掉，零收益零成本，明天一定賺 \(0\) 元。</li>
            <li>如果你訂一份報紙（\(q=1\)），有 \(6\%\) 的機率會賣掉零份（因為沒人想買），這種情況下你會賺 \(0−2+1=−1\) 元；有 \(94\%\) 的機率會賣掉一份（只要有一個以上的人想買），這種情況下你會賺 \(10−2=8\) 元。你的預期利潤是 \((-1) \times 0.06 + 8 \times 0.94 = 7.46\) 元。</li>
            <li>如果你訂兩份報紙（\(q=2\)），有 \(6\%\) 的機率會賣掉零份（因為沒人想買），這種情況下你會賺 \(0−4+2=−2\) 元；有 \(15\%\) 的機率會賣掉一份（如果恰好有一個人想買），這種情況下你會賺 \(10−4+1=7\) 元；有 \(79\%\) 的機率會賣掉兩份（只要有兩個以上的人想買），這種情況下你會賺 \(20−4=16\) 元。你的預期利潤是 \((-2) \times 0.06 + 7 \times 0.15 + 16 \times 0.79 = 13.57\) 元。</li>
        </ol>

        <p>顯然訂零份或訂一份都不是最好的，因為訂兩份比它們都好。事實上如果你繼續算下去，把 \(q=3,4,...,8\) 都算過一遍，會發現訂四份是最佳策略（\(q^* = 4\)）。當然如果環境改變（\(c\) 和 \(r\) 的值或 \(D\) 的分佈改變），結果就可能會不同。</p>

        <p>在這題中，你將會被給定 \(c\)、\(r\)、\(N\)、\(s\)、\(p_0\)、\(p_1\) 直到 \(p_N\)的值。你的任務是找出能最大化預期利潤的最佳訂貨量 \(q^*\)，以及在此訂貨量之下能得到的預期利潤 \(\pi(q^*)\) 無條件捨去到整數位。以本題的例子而言，就是 \(5\) 跟 \(20\)（請自己試著算算看；你會發現因為有了殘值，你會想要訂得多一點）。如果有數個訂貨量會導致一模一樣的預期利潤（是預期利潤一樣，不是無條件捨去之後一樣！），請用比較小的那一個當最佳訂貨量。</p>
        <h2>輸入輸出格式</h2>

        <p>在每筆測試資料中，會有 \(N+5\) 列，每一列都有一個數字。第一列的整數是單位進貨成本 \(c\)、第二列的整數是單位零售價格 \(r\)、第三列的整數是需求的可能個數 \(N\)、第四列是殘值 \(s\)、第五列開始的小數則依序是賣出零份、一份直到 \(N\) 份報紙的機率（也就是說對於 \(i=4,5,...,N+4\)，第 \(i\) 列記錄的是賣出 \(i−4\) 份報紙的機率）。已知 \(c\) 會落在 \(1\) 到 \(100\) 之間（包含 \(1\) 跟 \(100\)）、\(r\) 會落在 \(1\) 到 \(100\) 之間（包含 \(1\) 跟 \(100\)）且不會比 \(c\) 小、\(s\) 會落在 \(1\) 到 \(100\) 之間（包含 \(1\) 跟 \(100\)）且不會比 \(c\) 大、\(N\)會落在 \(1\) 到 \(1000\) 之間（包含 \(1\) 和 \(1000\)）。此外，對於 \(i=0,1,...,N\)，\(p_i\) 會介於 \(0\) 到 \(1\) 之間（包含 \(0\) 跟 1）、最多只有兩位小數，並且滿足 \(\sum_{i = 0}^N p_i = 1\)。</p>

        <p>讀入這些資料之後，你會計算並輸出在給定訂購量下的預期利潤無條件捨去到整數 \(\lfloor \pi(q) \rfloor\)</p>

        <p class="texti-datain">如果輸入是</p>
        <pre> <code>
2
10
10
1
0.06
0.15
0.22
0.22
0.17
0.1
0.05
0.02
0.01
0.0
0.0
        </code> </pre>
        <p>則輸出應該是</p>
        <pre> <code>
5 20
        </code> </pre>

        <p>其中 20 是期望利潤 20.47 無條件捨去後的結果。</p>
    </div>
</body>
</html>